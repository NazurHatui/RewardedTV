<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Marketplace â€” RewardedTV</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;}
    body{font-family:'Segoe UI',sans-serif;background:#0a0a0a;color:#e0e0e0;}
    a{color:inherit;text-decoration:none;}
    header{display:flex;justify-content:space-between;align-items:center;
      padding:1rem 2rem;background:#111;position:sticky;top:0;z-index:10;}
    header h1{color:#9b59b6;font-size:1.5rem;}
    .right-nav button{background:#9b59b6;color:#111;border:none;
      padding:0.5rem 1rem;border-radius:4px;cursor:pointer;}
    .right-nav button:hover{background:#8e44ad;}
    .controls{padding:1rem 2rem;display:flex;gap:1rem;background:#1c1c1c;}
    .controls select, .controls input{background:#111;border:1px solid #9b59b6;
      color:#e0e0e0;padding:0.5rem;border-radius:4px;flex:1;}
    .subsection{padding:1rem 2rem;background:#111;color:#9b59b6;
      font-size:1.25rem;font-weight:500;text-shadow:0 0 4px rgba(155,89,182,0.7);}
    .market-grid{padding:0 2rem 2rem;display:grid;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1.5rem;}
    .card{background:#1c1c1c;border-radius:8px;overflow:hidden;position:relative;
      box-shadow:0 4px 16px rgba(0,0,0,0.5);transition:transform .2s;}
    .card:hover{transform:translateY(-5px);}
    .card img{width:100%;display:block;}
    .card-body{padding:1rem;display:flex;flex-direction:column;align-items:center;}
    .card-body h2{font-size:1.1rem;color:#f39c12;margin-bottom:0.25rem;}
    .card-body .count{color:#ccc;font-size:0.9rem;margin-bottom:0.5rem;}
    .btn-list{background:#f39c12;color:#111;padding:0.5rem 1rem;border:none;
      border-radius:4px;cursor:pointer;width:100%;font-weight:500;text-transform:uppercase;
      box-shadow:0 0 8px rgba(243,156,18,0.6);}
    .btn-list:hover{background:#d78c10;}
    footer{padding:1rem 2rem;text-align:center;background:#111;color:#888;}
  </style>
</head>
<body>
  <header>
    <h1>ðŸ›’ Marketplace</h1>
    <div class="right-nav">
      <button onclick="location.href='index.html'">Home</button>
    </div>
  </header>

  <div class="controls">
    <select id="filter-type">
      <option value="all">All Types</option>
      <option value="helper">Helpers</option>
      <option value="pet">Pets</option>
    </select>
    <input id="search" placeholder="Search your items..." />
  </div>

  <div class="subsection">Your Collection</div>
  <section id="your-collection" class="market-grid"></section>

  <div class="subsection">Global Catalog</div>
  <section id="global-catalog" class="market-grid">
    <!-- Optionally load global items here -->
  </section>

  <footer>&copy; 2025 RewardedTV</footer>

  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  <script>
    // Init
    const firebaseConfig = {
      apiKey: "AIzaSyAZJwv-o931FA_nRB68UiT7gHIuzx-e5rQ",
      authDomain: "rewardedtv-1e5b1.firebaseapp.com",
      projectId: "rewardedtv-1e5b1"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db   = firebase.firestore();

    // Build a card element
    function makeCard(name, type, count) {
      const div = document.createElement('div');
      div.className = 'card';
      div.innerHTML = `
        <img src="assets/${name}.jpeg" alt="${name}" />
        <div class="card-body">
          <h2>${name}</h2>
          <div class="count">You own: ${count}</div>
          <p>Type: ${type}</p>
          <button class="btn-list">List for Sale</button>
        </div>`;
      div.querySelector('.btn-list').onclick = () => {
        const price = prompt(`Set sale price for ${name}:`);
        if (!price) return;
        // TODO: write a real listing to Firestore
        console.log('List', name, 'type', type, 'price', price);
        alert(`${name} listed at ${price} credits`);
      };
      return div;
    }

    auth.onAuthStateChanged(user => {
      if (!user) return location.replace('index.html');
      db.collection('users').doc(user.uid).get().then(doc => {
        const d = doc.data()||{};
        // Combine helpers & pets, count occurrences
        const all = [];
        (d.helpers||[]).forEach(h => all.push({name:h.name,type:'helper'}));
        (d.pets||[]).forEach(p => all.push({name:p.name,type:'pet'}));
        const counts = all.reduce((m,item)=>{
          const key = item.name+'|'+item.type;
          m[key] = (m[key]||0)+1;
          return m;
        },{});
        const container = document.getElementById('your-collection');
        container.innerHTML = '';
        Object.entries(counts).forEach(([key,count])=>{
          const [name,type] = key.split('|');
          container.appendChild(makeCard(name,type,count));
        });
      });
    });

    // Filtering & search
    document.getElementById('filter-type').onchange = () => {
      const t = document.getElementById('filter-type').value;
      document.querySelectorAll('#your-collection .card').forEach(c=>{
        const type = c.querySelector('p').innerText.split(': ')[1];
        c.style.display = (t==='all'||t===type)?'':'none';
      });
    };
    document.getElementById('search').oninput = () => {
      const q = document.getElementById('search').value.toLowerCase();
      document.querySelectorAll('#your-collection .card').forEach(c=>{
        const name = c.querySelector('h2').innerText.toLowerCase();
        c.style.display = name.includes(q)?'':'none';
      });
    };
  </script>
</body>
</html>
